<!DOCTYPE html>
<html lang="ru">
<head>
<!--  <script>window.BOHO_API_BASE='http://localhost:8080';</script>-->
    <!-- prod → '' (тот же домен), локалка → http://localhost:8080 -->
    <script>
        (function () {
          const isLocal = ['localhost','127.0.0.1'].includes(location.hostname);
          window.BOHO_API_BASE = isLocal ? 'http://localhost:8080' : '';
        })();
    </script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" type="image/png" href="images/logo.jpg">
  <title>Boho</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Lato:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<header>
  <div class="container nav">
    <a href="#top" class="brand">
      <img class="logo" src="images/logo.jpg" alt="Boho Spa интерьер" loading="lazy">
      <div class="brand__title">Boho - территория релакса и СПА</div>
    </a>
    <button class="menu-toggle" aria-label="Открыть меню" aria-expanded="false" aria-controls="primary-nav">
      <span></span><span></span><span></span>
    </button>
    <nav id="primary-nav" class="nav__links">
      <a class="nav__link" href="#services">Услуги</a>
      <a class="nav__link" href="#reviews">Отзывы</a>
      <a class="nav__link" href="#contacts">Контакты</a>
    </nav>
  </div>
</header>

<main id="top">
  <section class="hero container">
    <div class="hero__grid">
      <div class="reveal" data-anim="up" style="--reveal-delay:.02s">
        <h1 class="title">Территория спокойствия в сердце города</h1>
        <p class="subtitle" data-anim="fade" style="--reveal-delay:.06s">
          ‌Boho, вдохновленный свободой и естественностью. Погрузитесь в атмосферу Boho:
          натуральные материалы, этнические узоры и философия единения с природой. Ваше
          путешествие к балансу начинается здесь! Откройте мир, где время течёт иначе.
          Позвоните нам, если хотите записаться на процедуру.
        </p>
        <div class="hero__buttons">
          <a href="#services" class="btn btn--primary">Посмотреть услуги</a>
        </div>
      </div>
    </div>
    <div class="hero__photo reveal" data-anim="scale" style="--reveal-delay:.08s">
      <img src="images/fon.png" alt="Boho Spa интерьер" loading="lazy">
    </div>
  </section>

  <section id="services">
    <div class="container">
      <h2 class="h2 reveal" data-anim="up">Услуги</h2>

      <div class="overlay" id="card-overlay" hidden></div>

      <!-- Модалка с описанием услуги -->
      <div class="service-modal" id="service-modal" role="dialog" aria-modal="true" hidden>
        <h3 class="service-modal__title"></h3>
        <div class="service-modal__body"></div>
      </div>

      <div class="grid-3 services-grid">
        <article class="card service reveal" data-anim="scale">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>МАССАЖНЫЙ УХОД «ТИБЕТСКИЙ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/1.png" alt="Тибетский массаж — глубокие ткани">
            <p>Методика основана на древних знаниях, воздействует на глубокие слои мышечной ткани.

              Стоимость процедуры, зависит от продолжительности времени. Время процедуры может быть выбрано вами ,
              от 60 минут, до 120 минут.

              ** 60 минут — 5 000 ₽
              ** 90 минут — 7 500 ₽
              ** 120 минут — 10 000 ₽

              Имеются противопоказания</p>
            <button class="service__book-btn" type="button" data-service-id="1">Записаться</button>
          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.04s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>МАССАЖНЫЙ УХОД «БАЛАНС»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/2.png" alt="Массаж Баланс — релакс и антистресс">
            <p>** Методика направлена на расслабление тела и снятие эмоционального напряжения.

              ** По вашему желанию, специалист может использовать эфирные масла doTerra.

              * Стоимость процедуры, зависит от продолжительности времени. Время процедуры может быть выбрано вами ,
              от 30 минут, до 120 минут.

              ** 30 минут — 1 500 ₽
              ** 60 минут — 2 600 ₽
              ** 90 минут — 3 900 ₽
              ** 120 минут — 5 200 ₽

              ** Имеются противопоказания</p>
            <button class="service__book-btn" type="button" data-service-id="2">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.08s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>МАССАЖ ГОЛОВЫ «СНЫ ВСЕЛЕННОЙ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/3.png" alt="Массаж головы — глубокое расслабление">
            <p>** Расслабляющий массаж головы.

              ** По вашему желанию, специалист может использовать эфирные масла doTerra.

              * Стоимость процедуры, зависит от продолжительности времени. Время процедуры может быть выбрано вами ,
              от 30 минут, до 90 минут.

              ** 30 минут — 600 ₽
              ** 60 минут — 1 200 ₽
              ** 90 минут — 1 800 ₽


              ** Имеются противопоказания</p>
            <button class="service__book-btn" type="button" data-service-id="3">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.02s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>СПА РИТУАЛ «ДЫХАНИЕ СВОБОДЫ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/4.png" alt="СПА ритуал Дыхание свободы">
            <p>Когда горные травы рождают освобождение от усталости. Откройтесь навстречу переменам. Приглашаем вас на
              уникальный ритуал перезагрузки, созданный для тех, кто жаждет сбросить напряжение и вспомнить вкус
              абсолютной, лёгкой свободы.


              1 ** Парение — «Лесной шепот «
              Погрузитесь в облако целебного пара, настоянного на дуэте эвкалипта и лавра. Как будто порыв свежего
              ветра в густом лесу, этот воздух очистит ваше дыхание, расширит горизонты чувств и подготовит сознание к
              путешествию, смывая груз повседневности.
              * ( 30 минут)

              2 ** Скрабирование — «Мятная прохлада дюн «
              Ваше тело станет полотном для массажа морской солью, заряженной кристальной свежестью ментола. Это не
              эксфолиация, а пробуждение. Ощутите, как крупинки соли, подобные песчинкам у океана, мягко отшелушивают
              всё отжившее, а прохлада мяты дарит коже невероятную гладкость и живительный тонус.
              * ( 30 минут)

              3 ** Обертывание-медитация — «Древо камфоры «
              Насладитесь глубоким согревающим обертыванием с камфорой. Это момент, когда внешний мир перестаёт
              существовать. Тепло, идущее изнутри, мягко расслабляет каждую мышцу, растворяя остатки стресса, словно
              первые лучи утреннего солнца согревают землю после прохладной ночи.
              * ( 30 минут)

              4 ** Согревающий массажный уход — «Тепло касаний «
              Руки специалиста, совершат танец под ритм вашего дыхания, используя целебную силу оливкового масла
              холодного отжима и эфирного масла орегано dōTERRA. Этот глубокий, согревающий уход разгонит энергию,
              снимет мышечные зажимы и наполнит тело силой земли, её жизненной энергией и теплом.
              * ( 60 минут)

              5 ** Финал — «Шёпот лаванды «
              Путешествие завершится лёгким, почти невесомым прикосновением. На височную область будет нанесена капля
              чистейшего эфирного масла лаванды dōTERRA. Его умиротворяющий аромат закрепит состояние блаженства,
              усыпит тревоги и подарит ясность ума, чтобы вынести это состояние гармонии за пределы нашего
              пространства.
              * ( 10 минут)

              6 ** Чайная церемония — «Бохо — уединение «
              Забудьте о счете минут. Это время, целая вселенная, сотканная только для вас. В нашем уютном уголке,
              наполненном ароматом сушеных трав, мягким светом солнца сквозь макраме и теплом грубой керамики, время
              течет иначе. Вы не просто гость, вы — главное действующее лицо.
              * ( 60 минут)

              Подарите себе состояние полёта. Верните себе право дышать полной грудью.

              ** Продолжительность ** ~ 3 часа, 40 минут.

              ** Стоимость программы — 8 000 ₽ ( один гость)

              ** Стоимость программы — 16 000 ₽ ( два гостя)

              ** Стоимость программы с 20:00 до 23:40

              ** 10 000 ₽ ( один гость)

              ** 20 000 ₽ ( два гостя)</p>
            <button class="service__book-btn" type="button" data-service-id="4">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.06s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>СПА РИТУАЛ «ЛЮБОВЬ МОРЯ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/5.png" alt="СПА ритуал Любовь моря">
            <p>Любовь моря — это гимн простоте и силе природы, созданный для свободных духом.
              Мы создали для вас многослойный ритуал — ваш билет на побережье. Без самолетов, только чистая природа.



              1 ** Парение — «Мятный Шалтим»
              Погрузитесь в облако целебного пара, заряженного кристально чистотой морской соли и свежестью дикой
              мяты. Это не просто парение, а глубокое очищение дыхания и мыслей, подготовка тела к прикосновениям.
              * ( 30 минут)

              2 ** Скрабирование — «Дикое побережье»
              Груинд морской соли и целебной ламинарии мягко отшелушивает все лишнее, обнажая кожу сияющую как
              перламутр.Пробуждая тело и чувства к новым ощущениям.
              * (30 минут)

              3 ** Обертывание — «Объятия ламинарии»
              Мы укутаем вас в питательный коктейль из ламинарии и фукуса, словно в прохладные, целебные воды моря. Вы
              почувствуете, как мощь морских глубин насыщает каждую клеточку, подтягивая, тонизируя и даря ощущение
              невесомости.
              * ( 30 минут)

              4 ** Массажный уход — «Золотое солнце Оливы»
              Теплое масло оливы, струящееся по телу подобно средиземноморскому солнцу, завершит ритуал. Глубокий,
              расслабляющий массажный уход, впитает в себя всю силу моря и земли, запечатывая в вас состояние
              глубокого умиротворения.
              * (60 минут)

              5 ** Чайная церемония — «Диалог со стихией»
              Это не просто чаепитие. Это момент когда с каждым глотком, вы пьете тишину и покой, могучего, но такого
              щедрого моря. Подарите себе возможность мягко «вернуться на берег», сохранив в сердце частицу моря.
              * ( 60 минут)

              Позвольте себе уплыть от реальности. Ваше тело станет легким, а душа — ясной и безмятежной.

              ** Продолжительность ** ~ 3 часа , 30 минут

              ** Стоимость программы — 8 000 ₽ ( один гость)

              ** Стоимость программы — 16 000 ₽ ( два гостя)

              ** Стоимость программы с 20:00 до 23:40

              ** 10 000 ₽ ( один гость)

              ** 20 000 ₽ ( два гостя)</p>
            <button class="service__book-btn" type="button" data-service-id="5">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.1s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>СПА РИТУАЛ «ПЕСНЬ ЛУГОВЫХ ЦВЕТОВ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/6.png" alt="СПА ритуал Песнь луговых цветов">
            <p>Очищение в ритме природы. Забудьте о суете города и позвольте себе унестись в дикий, прекрасный и
              щедрый мир. Наша программа — это не просто ритуал красоты, а настоящее путешествие в самое сердце
              цветущего луга, на опушку древней тайги, где травы шепчут древние секреты чистоты и гармонии.


              1 ** Парение — «Дух Тайги»
              Погрузитесь в облако целебного пара, настоянного на душистом разнотравье таежных лугов. Это глубокое
              прогревание, которое подобно первому летнему дождю, мягко очищает поры, готовя тело и дух к таинству
              обновления.
              * ( 30 минут)

              2 ** Скрабирование — «Щедрость леса»
              К вашей коже прикоснется не просто скраб, а крупинки соли, смешанные с грубым помолом таежных кореньев и
              хвои. Этот ритуал — словно прогулка босиком по лесной тропинке: она отшелушивает всё отжившее, обнажая
              нежную, новую кожу и даря ощущение невесомости.
              * ( 30 минут)

              3 ** Обертывание — «Ласка темнолесья»
              Вас укутают в бархатный, ароматный бальзам, рожденный в чаще из смол, ягод и мощных таежных трав. Это
              момент глубокого диалога с природой, когда её дары проникают в каждую клеточку, выводя накопленное и
              насыщая силой вековых лесов.
              * ( 30 минут)

              4 ** Массажный уход — «Сон кедровой рощи»
              Финал программы, танец рук массажиста под аккомпанемент густого, смолистого аромата сибирского кедра.
              Ценное масло, словно жидкое солнце, впитывается, завершая очищение, даря коже невероятную мягкость, а
              телу — чувство полного, глубокого умиротворения.
              * ( 60 минут)

              5 ** Чайная церемония — «Травьи настои»
              Пока настой томиться, настаивается, рождается. Это время тишины. Время , чтобы замедлиться, подремать в
              лучах теплого солнца. Посмотреть как танцуют травы в воде. И услышать как само время останавливает свой
              бег. Это медитация втроем: вы, чаша и безмолвный луг, что ожил в ней.
              * ( 60 минут)

              Песнь Луговых Цветов — это возвращение к себе настоящему, дикому и свободному. Это гимн чистоте, спетый
              шепотом трав и могуществом тайги.
              Позвольте природе стать вашим целителем.

              ** Продолжительность ** ~ 3 часа , 30 минут

              ** Стоимость программы — 8 000 ₽ ( один гость)

              ** Стоимость программы — 16 000 ₽ ( два гостя)


              ** Стоимость программы с 20:00 до 23:40

              ** 10 000 ₽ ( один гость)

              ** 20 000 ₽ ( два гостя)</p>
            <button class="service__book-btn" type="button" data-service-id="6">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.02s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>СПА РИТУАЛ «ПРИКОСНОВЕНИЕ СОЛНЦА»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/7.png" alt="СПА ритуал Прикосновение солнца">
            <p>Приглашение ощутить беззаботную теплоту летнего дня, аромат цветущих трав и цитрусовый всплеск спелого
              грейпфрута. Это гимн простой, но глубокой красоте, идущей от солнца.




              1 ** Парение — «Солнечный ветер «
              Мы начинаем парение с лёгкого пара, настоянного на ромашке и цедре солнечного грейпфрута. Как будто вы
              лежите в поле, а над вами проносится тёплый ветер, несущий ароматы цветущего луга. Он мягко готовит тело
              и ум к пробуждению.
              * ( 30 минут)

              2 ** Обтирание «Сочный грейпфрут»
              Освежающее и бодрящее обтирание охлаждённым грейпфрутом. Его сок, подобно утренней росе, очищает и
              тонизирует кожу, даря ей мгновенное ощущение свежести и лёгкой, едва уловимой терпкости.
              * ( 5 минут)

              3 ** Скрабирование — «Мёд и соль «
              Натуральный скраб из кристаллов морской соли и густого цветочного мёда. Морская соль, будто вобравшая в
              себя силу моря, мягко отшелушивает, а тёплый мёд, словно золотые лучи солнца, смягчает и питает. Эта
              процедура — объятия моря и солнца, оставляющее кожу невероятно гладкой и сияющей изнутри.
              * ( 30 минут)

              4 ** Обёртывание — «Золото облепихи «
              Насыщенное укутывание из облепихового масла — настоящего солнечного эликсира, цвета заката. Это глубокое
              питание и насыщение витаминами. Вы почувствуете, как кожа напитывается теплом и живительной силой ягод,
              которые словно вобрали в себя всё лето.
              * ( 30 минут)

              5 ** Массажный уход -«Бесконечность «
              Завершающая нота ритуала — медленный, медитативный массажный уход с маслом оливы холодного отжима. Это
              масло — древний символ жизни и мудрости. Плавные, заземляющие движения мастера дарят глубокое
              расслабление, снимая все следы напряжения, а масло завершает преображение, даря коже шелковистость и
              умиротворённое сияние.
              * ( 60 минут)

              6 ** Чайная церемония — «Солнечное сияние»
              Это не просто чаепитие, а плавное завершение вашего «Прикосновения Солнца». Мы предлагаем вам травяной
              тизан с ромашкой, тонкими дольками сушёного грейпфрута, щепоткой душистых трав и лепестками календулы.
              Этот напиток — жидкое воплощение всего, что вы ощутили во время ритуала: цветочно-цитрусовый аромат,
              лёгкая горчинка, сменяющаяся медовой сладостью и долгим, тёплым послевкусием.
              * ( 60 минут)

              Отпустите привычное и ощутите прикосновение
              Солнца.

              ** Продолжительность ** ~ 3 часа , 35 минут

              ** Стоимость программы — 8 000 ₽ ( один гость)

              ** Стоимость программы — 16 000 ₽ ( два гостя)


              ** Стоимость программы с 20:00 до 23:40

              ** 10 000 ₽ ( один гость)

              ** 20 000 ₽ ( два гостя)</p>
            <button class="service__book-btn" type="button" data-service-id="7">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.06s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>ЭКСПРЕСС «ПО ТРАВЕ БОСИКОМ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/8.png" alt="Экспресс По траве босиком">
            <p>1 ** Парение с арома маслами,
              на перине из таежных трав.
              * (30 минут)

              2 ** Массажный уход стоп.
              * (30 минут)

              ** Стоимость процедуры — 2 500 ₽

              * Имеются противопоказания.</p>
            <button class="service__book-btn" type="button" data-service-id="8">Записаться</button>          </div>
        </article>

        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.1s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>ЭКСПРЕСС «КРЫЛО БАБОЧКИ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/9.png" alt="Экспресс Крыло бабочки">
            <p>1 ** Гоммаж тела.
              * (30 минут)

              2 ** Массажный уход спины.
              * (30 минут)

              ** Стоимость процедуры — 2 500 ₽

              * Имеются противопоказания.</p>
            <button class="service__book-btn" type="button" data-service-id="9">Записаться</button>          </div>
        </article>
        <article class="card service reveal" data-anim="scale" style="--reveal-delay:.1s">
          <button class="service__summary" type="button" aria-expanded="false">
            <h3>ЭКСПРЕСС РИТУАЛ «ЯСНОСТЬ МЫСЛИ»</h3>
          </button>
          <div class="service__details" hidden>
            <img src="images/services/10.png" alt="Экспресс Крыло бабочки">
            <p>1 ** Гоммаж тела.
              * (30 минут)

              2 ** Массажный уход спины.
              * (30 минут)

              ** Стоимость процедуры — 2 500 ₽

              * Имеются противопоказания.</p>
            <button class="service__book-btn" type="button" data-service-id="10">Записаться</button>          </div>
        </article>
      </div>
    </div>
    </div>

    <!-- МОДАЛКА ФОРМЫ ЗАПИСИ (единственная!) -->
    <div class="booking-modal" id="booking-modal" role="dialog" aria-modal="true" hidden>
      <h3 class="booking-modal__title">Запись на услугу</h3>
      <form id="bookingForm" class="booking-form" novalidate>
        <input type="hidden" id="bookingServiceId" name="serviceId">

        <label class="field">
          <span>Имя</span>
          <input id="bookingName" name="name" type="text" required minlength="2" maxlength="60">
          <div class="error" data-for="name"></div>
        </label>

        <label class="field">
          <span>Телефон</span>
          <input id="bookingPhone" name="phone" type="tel" placeholder="+7 (9__) ___-__-__" maxlength="18" required>
          <div class="error" data-for="phone"></div>
        </label>

        <label class="field">
          <span>Длительность</span>
          <select id="bookingDuration" name="serviceDurationId" required>
            <option value="" selected disabled>Выберите длительность…</option>
          </select>
          <div class="error" data-for="serviceDurationId"></div>
        </label>

        <div class="row">
          <label class="field">
            <span>Дата</span>
            <input id="bookingDate" name="date" type="date" required>
            <div class="error" data-for="date"></div>
          </label>
          <label class="field">
            <span>Время</span>
            <select id="bookingTime" name="time" required></select>
            <div class="error" data-for="time"></div>
          </label>
        </div>

        <label class="field">
          <span>Комментарий</span>
          <textarea id="bookingComment" name="comment" rows="3"></textarea>
        </label>

        <div class="actions">
          <button type="button" class="btn btn-secondary" id="bookingCancel">Отмена</button>
          <button type="submit" class="btn btn-primary" id="submitBooking">Отправить заявку</button>
        </div>
      </form>
    </div>

  </section>

  <section id="reviews"> <!-- оставляю как у тебя --> </section>
  <section id="contacts"> <!-- оставляю как у тебя --> </section>
</main>

<footer>
  <div class="container footer__grid">
    <div>© <span id="year"></span></div>
    <div class="muted">Boho - территория релакса и СПА</div>
  </div>
</footer>

<button class="back-to-top" aria-label="Наверх" title="Наверх">↑</button>

<!-- БАЗОВЫЕ СКРИПТЫ UI -->
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click', e=>{
      const id=a.getAttribute('href'); if(id.length>1){ e.preventDefault(); document.querySelector(id)?.scrollIntoView({behavior:'smooth'}); }
    });
  });

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!prefersReduced && 'IntersectionObserver' in window) {
    const io=new IntersectionObserver((entries)=>{ entries.forEach(el=>{ if(el.isIntersecting){ el.target.classList.add('is-visible'); io.unobserve(el.target);} }); },{threshold:0.12, rootMargin:'0px 0px -10% 0px'});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
  } else { document.querySelectorAll('.reveal').forEach(el=>el.classList.add('is-visible')); }

  const toggle=document.querySelector('.menu-toggle'); const nav=document.getElementById('primary-nav');
  toggle?.addEventListener('click',()=>{
    const expanded=toggle.getAttribute('aria-expanded')==='true';
    toggle.setAttribute('aria-expanded', String(!expanded)); nav.classList.toggle('open');
  });

  const toTopBtn=document.querySelector('.back-to-top');
  const toggleToTop=()=>{ const y=window.scrollY||document.documentElement.scrollTop; toTopBtn?.classList.toggle('show', y>400); };
  toggleToTop(); window.addEventListener('scroll', toggleToTop, {passive:true});
  toTopBtn?.addEventListener('click',()=>window.scrollTo({top:0, behavior:'smooth'}));
</script>

<!-- МОДАЛКА УСЛУГ -->
<script>
  (function(){
    const overlay=document.getElementById('card-overlay');
    const modal=document.getElementById('service-modal');
    const modalTitle=modal.querySelector('.service-modal__title');
    const modalBody=modal.querySelector('.service-modal__body');
    const cards=[...document.querySelectorAll('.service')];

    let isLocked=false, scrollY=0;
    function lock(){ if(isLocked) return; scrollY=window.scrollY||0; Object.assign(document.body.style,{position:'fixed', top:`-${scrollY}px`, left:'0', right:'0', width:'100%'}); isLocked=true; }
    function unlock(){ if(!isLocked) return; Object.assign(document.body.style,{position:'', top:'', left:'', right:'', width:''}); window.scrollTo(0, scrollY); isLocked=false; }

    function openFromCard(card){
      const title=card.querySelector('.service__summary h3')?.textContent?.trim()||'';
      const detailsHTML=card.querySelector('.service__details')?.innerHTML||'';
      modalTitle.textContent=title; modalBody.innerHTML=detailsHTML;
      modal.hidden=false; overlay.hidden=false; lock();
    }
    function closeModal(){ modal.hidden=true; overlay.hidden=true; modalTitle.textContent=''; modalBody.innerHTML=''; unlock(); }

    cards.forEach(card=>{
      card.querySelector('.service__summary')?.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation(); openFromCard(card); });
    });

    modal.addEventListener('click', closeModal);
    overlay.addEventListener('click', ()=>{
      const bookingOpen=!document.getElementById('booking-modal').hidden;
      if(!bookingOpen) closeModal();
    });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && !modal.hidden) closeModal(); });
  })();
</script>
<!-- мини-тост (по желанию стилизуешь в CSS) -->
<style>
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);padding:10px 14px;border-radius:10px;background:#222;color:#fff;opacity:.0;pointer-events:none;transition:.25s;z-index:9999}
  .toast.visible{opacity:.95}
</style>
<div class="toast" hidden></div>

<script>
  (function(){
    const API = (window.BOHO_API_BASE || "").replace(/\/+$/,'');

    // DOM
    const overlay      = document.getElementById('card-overlay');
    const serviceModal = document.getElementById('service-modal');
    const modal        = document.getElementById('booking-modal');
    const form         = document.getElementById('bookingForm');
    const titleEl      = modal.querySelector('.booking-modal__title');

    const hid    = document.getElementById('bookingServiceId');
    const nameI  = document.getElementById('bookingName');
    const phoneI = document.getElementById('bookingPhone');
    const durSel = document.getElementById('bookingDuration'); // value = ID длительности
    const dateI  = document.getElementById('bookingDate');
    const timeSel= document.getElementById('bookingTime');     // <select> HH:mm
    const commI  = document.getElementById('bookingComment');
    const cancel = document.getElementById('bookingCancel');
    const submit = document.getElementById('submitBooking');

    // ===== утилиты =====
    const toast = document.querySelector('.toast');
    function showToast(msg){ toast.textContent=msg; toast.hidden=false; toast.classList.add('visible'); setTimeout(()=>{ toast.classList.remove('visible'); setTimeout(()=>toast.hidden=true,220); }, 2000); }

    async function apiGET(url){ const r=await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    async function apiPOST(url, body, headers={}) {
      const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json', ...headers}, body:JSON.stringify(body) });
      const t = await r.text(); let j=null; try{ j=t?JSON.parse(t):null; }catch{}
      if(!r.ok){ const e=new Error(j?.message||j?.error||t||('HTTP '+r.status)); e.status=r.status; e.payload=j; throw e; }
      return j ?? {};
    }
    function uuid(){ return (crypto.randomUUID ? crypto.randomUUID() : (Date.now() + '-'+ Math.random().toString(16).slice(2))); }

    // сетка времени 10:00..22:00 шаг 15 мин
    const GRID = (()=>{const out=[],d=new Date(),e=new Date();d.setHours(10,0,0,0);e.setHours(22,0,0,0);
      while(d<e){ out.push(d.toTimeString().slice(0,5)); d.setMinutes(d.getMinutes()+15); }
      return out;})();

    function overlaps(aStart,aEnd,bStart,bEnd){
      return new Date(aStart) < new Date(bEnd) && new Date(bStart) < new Date(aEnd);
    }

    // ===== блокировка скролла и фокус-трап =====
    let lock=false, scrollY=0, prevFocus=null;
    function lockScroll(){
      if(lock) return;
      scrollY = window.scrollY||0;
      prevFocus = document.activeElement;
      Object.assign(document.body.style,{position:'fixed', top:`-${scrollY}px`, left:0, right:0, width:'100%'});
      lock=true;
      trapFocusEnable();
    }
    function unlockScroll(){
      if(!lock) return;
      Object.assign(document.body.style,{position:'', top:'', left:'', right:'', width:''});
      window.scrollTo(0,scrollY);
      lock=false;
      trapFocusDisable();
      try{ prevFocus && prevFocus.focus(); }catch{}
    }
    function trapFocusEnable(){
      modal.addEventListener('keydown', focusTrap);
    }
    function trapFocusDisable(){
      modal.removeEventListener('keydown', focusTrap);
    }
    function focusTrap(e){
      if(e.key !== 'Tab') return;
      const FOCUSABLE = modal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
      const list = [...FOCUSABLE].filter(el=>!el.hasAttribute('disabled'));
      if(!list.length) return;
      const first = list[0], last = list[list.length-1];
      if(e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if(!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }

    // ===== маска телефона +7 (9xx) xxx-xx-xx =====
    const RU = /^\+7\s?\(9\d{2}\)\s?\d{3}-\d{2}-\d{2}$/;
    function digits(s){ return (s||'').replace(/\D/g,''); }
    function fmtPhone(raw){
      let d = digits(raw);
      if(d.startsWith('8')) d = '7' + d.slice(1);
      if(d.startsWith('9')) d = '79' + d.slice(1);
      if(!d.startsWith('7')) d = '7' + d;
      d = d.slice(0,11);
      const p = (i)=>d[i]||'';
      let out = `+${p(0)} (${p(1)}${p(2)}${p(3)}) ${p(4)}${p(5)}${p(6)}`;
      if(p(7)) out += `-${p(7)}${p(8)}`;
      if(p(9)) out += `-${p(9)}${p(10)}`;
      return out.replace('( )','(9)').trim();
    }
    phoneI.addEventListener('input', ()=>{ const cur = phoneI.selectionStart||phoneI.value.length; const old=phoneI.value; phoneI.value=fmtPhone(old); try{ phoneI.setSelectionRange(phoneI.value.length, phoneI.value.length);}catch{} });
    phoneI.addEventListener('blur',  ()=> setErr(phoneI, RU.test(phoneI.value.trim()) ? '' : 'Формат: +7 (9xx) xxx-xx-xx'));
    if(!phoneI.value) phoneI.value = '+7 (9';

    // ===== ошибки и валидация =====
    function setErr(el,msg){ const box=form.querySelector(`.error[data-for="${el.name}"]`); if(box) box.textContent=msg||''; el.classList.toggle('invalid', !!msg); }
    function valid(){
      let ok=true;
      setErr(nameI,''); setErr(phoneI,''); setErr(durSel,''); setErr(dateI,''); setErr(timeSel,'');
      if(!nameI.value.trim()){ setErr(nameI,'Укажите имя'); ok=false; }
      if(!RU.test(phoneI.value.trim())){ setErr(phoneI,'Формат: +7 (9xx) xxx-xx-xx'); ok=false; }
      if(!durSel.value){ setErr(durSel,'Выберите длительность'); ok=false; }
      if(!dateI.value){ setErr(dateI,'Выберите дату'); ok=false; }
      if(!timeSel.value){ setErr(timeSel,'Выберите время'); ok=false; }
      return ok;
    }

    // ===== загрузка длительностей =====
    async function loadDurations(serviceId){
      durSel.innerHTML='<option>Загрузка…</option>';
      const list = await apiGET(`${API}/api/services/${serviceId}/durations`);
      durSel.innerHTML='';
      list.forEach(d=>{
        const opt = new Option(
                d.priceCents!=null ? `${d.durationMin} мин — ${(d.priceCents/100).toFixed(0)} ₽` : `${d.durationMin} мин`,
                String(d.id)
        );
        opt.dataset.durationMin = d.durationMin;
        durSel.appendChild(opt);
      });
    }

    // ===== отрисовка времени (учёт занятости + прошлого времени на "сегодня") =====
    async function renderTimes(serviceId){
      timeSel.innerHTML='';
      if(!dateI.value || !durSel.value) return;

      const busy = await apiGET(`${API}/api/slots/busy?serviceId=${serviceId}&date=${dateI.value}`);
      const minutes = Number(durSel.selectedOptions[0]?.dataset?.durationMin || 60);

      const now = new Date();
      const isToday = dateI.value === `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

      const disabled = new Set();
      GRID.forEach(t=>{
        const start = new Date(`${dateI.value}T${t}:00`);
        const end   = new Date(start); end.setMinutes(end.getMinutes()+minutes);

        // запрещаем прошлое время для сегодняшней даты
        const past = isToday && end.getTime() <= now.getTime();

        const conflict = busy.some(b => overlaps(start, end, b.start, b.end));
        const opt = new Option(t + (conflict?' — занято': (past?' — прошло':'')), t, false, false);
        if (conflict || past) { opt.disabled = true; disabled.add(t); }
        timeSel.appendChild(opt);
      });

      // авто-выбор ближайшего свободного
      const firstFree = GRID.find(x => !disabled.has(x));
      timeSel.value = firstFree || '';
      if(!firstFree){
        showToast('Свободных слотов на выбранную дату нет');
      }
    }

    // ===== открытие из карточки =====
    document.body.addEventListener('click', async (e)=>{
      const btn = e.target.closest('.service__book-btn');
      if(!btn) return;

      const serviceId = Number(btn.dataset.serviceId||0);
      if(!serviceId){ showToast('У кнопки нет data-service-id'); return; }

      // заголовок тянем из модалки услуги, если она открыта
      const t = serviceModal.querySelector('.service-modal__title')?.textContent?.trim();
      titleEl.textContent = t || 'Запись на услугу';

      hid.value = String(serviceId);

      // мин. дата — сегодня
      const now = new Date(); const y=now.getFullYear(), m=String(now.getMonth()+1).padStart(2,'0'), d=String(now.getDate()).padStart(2,'0');
      dateI.min = `${y}-${m}-${d}`;
      if(!dateI.value) dateI.value = dateI.min;

      // показать форму
      serviceModal.hidden = true;
      overlay.hidden = false;
      modal.hidden = false;
      lockScroll();

      try{
        await loadDurations(serviceId);
        await renderTimes(serviceId);
        nameI.focus({preventScroll:true});
      }catch(err){
        console.error(err);
        showToast('Не удалось загрузить параметры услуги');
      }
    });

    // ===== закрытие =====
    function close(){
      modal.hidden=true; overlay.hidden=true; form.reset(); unlockScroll();
    }
    cancel.addEventListener('click', close);
    overlay.addEventListener('click', ()=>{ if(!modal.hidden) close(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !modal.hidden) close(); });

    // ===== дебаунс на переключениях (чтобы не дёргать бэкенд слишком часто) =====
    let timr=null;
    function debounce(fn, ms){ return (...a)=>{ clearTimeout(timr); timr=setTimeout(()=>fn(...a), ms); }; }
    const rerenderDebounced = debounce(async (sid)=>{ if(sid) await renderTimes(sid); }, 120);

    durSel.addEventListener('change', ()=> rerenderDebounced(Number(hid.value||0)));
    dateI .addEventListener('change', ()=> rerenderDebounced(Number(hid.value||0)));

    // ===== сабмит =====
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!valid()) return;

      const serviceId        = Number(hid.value);
      const serviceDurationId= Number(durSel.value);
      const startLocal       = `${dateI.value}T${timeSel.value}`;

      // лоадер на кнопке
      submit.classList.add('loading');
      submit.disabled = true;

      try{
        await apiPOST(`${API}/api/appointments`, {
          serviceId, serviceDurationId, startLocal,
          customerName: nameI.value.trim(),
          customerPhone: phoneI.value.trim(),
          comment: commI.value.trim()
        }, { 'Idempotency-Key': uuid() });

        showToast('✅ Заявка отправлена. Мы свяжемся с вами.');
        close();
      }catch(err){
        if(err.status===409){
          showToast('Этот слот уже занят. Обновляю варианты…');
          await renderTimes(serviceId);
          timeSel.focus();
        }else if(err.status===400 && err.payload){
          // попытка красиво разнести ошибки от бэка
          const map = err.payload?.errors||{};
          if(map.customerName) setErr(nameI,  String(map.customerName));
          if(map.customerPhone)setErr(phoneI, String(map.customerPhone));
          if(map.serviceDurationId) setErr(durSel, String(map.serviceDurationId));
          if(map.startLocal)  setErr(timeSel, String(map.startLocal));
          showToast('Проверьте поля формы');
        }else{
          console.error(err);
          showToast('Ошибка бронирования: ' + (err.message||'неизвестно'));
        }
      }finally{
        submit.classList.remove('loading');
        submit.disabled = false;
      }
    });

  })();
</script>




</body>
</html>
